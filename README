ww6: Web Application Framework for Perl 6

=== Story ===

In the beginning was Webtoo Websight, and it was good.
Based on the Perlite libraries it was, and they were good.

Both had reached a mighty version number of 5, but both had also
reached a point where a complete rewrite was in order.

It could have been done in Perl 5, as both were already written in
said language. It could have been done with magical tools such as
Moose, to make it stronger and easier to debug.

But then, the Great Architect said, "no."

And proceeded to rewrite the whole thing, in Perl 6.

This is the result.

=== Dependencies ===

 = Requirements =

- The January 2010 release of Rakudo Perl 6.
  This WILL NOT work with newer releases (yet) as they are based on a new
  core that has not finished adding the functionality from the previous
  core. I expect that by April 2010, the new core will have not only
  caught up to the old one, but have far surpassed it. Stay tuned!

 = Recommended =

- The SCGI library for Perl 6
  http://github.com/supernovus/SCGI
  This library was written specifically because I was frustrated testing
  ww6 as a CGI script, where the performance was abysmal.
  This is HIGHLY recommended, as using Perl 6 with plain CGI is unbearable.

- If you want to run the SCGI process on a computer behind NAT,
  and have the publically accessible web server forward requests
  to it, you can look into the reverse proxy functionality of OpenSSH.
  The 'service.sh' included shows how I have it set up to run on my home
  computer, and forward to my publically accessible VPS.

=== Technical Details ===

 = WTDL =

The data definition language (WTDL) may at first glimse look like YAML,
but it is most certainly NOT. It has many significant differences, and is
currently highly specific to ww6. It may be possible to make it a standalone
library, but I don't see the point right now.

The biggest difference between YAML and WTDL is that WTDL is based on
merging multiple data sets, and so has operators for HOW to merge the
data (e.g., in the case of Arrays, you can append to the end of the
existing array, or insert in front of the original array.)

 = WTML =

The Content plugin looks for files ending in .wtml by default.
Plugins can parse the .wtml files in any way they wish.

The default Metadata plugin looks for a section of WTDL formatted text
in a block of <metadata>...</metadata>.

There is a template parser called WTML that supports Tags and If statements, 
similar to the Perlite parsers from ww5. 

The format has changed slightly since the ww5 days, 
making it more streamlined, and including changes from integrating
the Tags and If parsers together.

Where in ww5 a template may look like:

<if "<page.type>"~="admin">
<andif "<auth.user>"="<page.owner>">
  Hi bob, you are on a <page.type> page.
<elsif ! "<page.ooya>">
  Booga!
<else>
  Never mind
</if>
<if "<page.links>">
<recurse page.links>
  <a href="<page.links.url>"><page.links.title></a>
</recurse>
</if>

A ww6 template would have instead:

<if $page.type ~~ "admin" and $auth.user = $page.owner>
  Hi bob, you are on a <page.type/> page.
<else ! $page.ooya />
  Booga!
<else/>
  Never mind
</if>
<if $page.links>
<page.links>
  <a href="%page.links.url"><page.links.title/></a>
</page.links>
</if>

The closing slashes are optional, but recommended for clarity.
In addition to 'and' there is also 'or'.

There are three formats recognized by WTML for variables:

 <variable.name/>  Is parsed directly. No changes are made.
 $variable.name    Adds "quote" characters around the value (for <if> tags.)
 %variable.name    URL encodes the value (for href, src, etc.)

Also, the following comparisons have changed their names:

Old name => New name
   >     =>  gt
   <     =>  lt
   >=    =>  gt=
   <=    =>  lt=
   ~=    =>  ~~

The '=' comparison always uses string comparison.
The '==' comparison will use numeric comparison if both values are numbers,
otherwise it will use string comparison.

=== Not yet finished ===

This project is still under construction, and does not include all of the
functionality from Webtoo Websight 5 yet.

Hopefully it will soon exceed the older version.

Timothy M. Totten

